var step1,step2,step3,step4,footer,header,IBEStepsMain,myReservation,customerLogin,guestPreferences,account,benefit,reservation,loader,contact,ratePlan,lang,member;$(document).ready((function(){"object"==typeof google&&"object"==typeof google.maps||($.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyAwNrMVC8KUcrJXw5ceZbJJ6NP2rK37TBQ",(function(){})),IBE.Config.display_header&&$("#Currency").show())}));var routes={1:"Step1",2:"Step2",3:"Step3",4:"Step4",Rateplan:"Rateplan",MyReservation:"MyReservation",Contact:"Contact",Membership:"Membership"};function MainView(){var e=this;e.lang=ko.observable(""),e.currency=ko.observable(""),e.ready=ko.observable(!1),e.updateCustomerPreferences=ko.observable(!1),e.ready.subscribe((function(t){loader.visible(!t),t&&($(".dropdown").removeClass("open"),e.applyBodyClass(),$.wait(500).then(e.animate.steps),$.wait(500).then((function(){e.navigationSteps(e.currentStep-1)})))})),e.metaTitles=["Step 1 - Booking Engine","Step 2 - Booking Engine","Step 3 - Booking Engine","Step 4 - Booking Engine","Contact- Booking Engine","My Reservation - Booking Engine","Membership - Booking Engine"],e.isIntegratedPage=function(){var e=!1,t=IBEConfig.integrated_page;return t=t.replace(/\/?$/,""),(window.location.href.indexOf(t)>-1||window.location.href.indexOf(t+"?page=MyAccount")>-1)&&(e=!0),e},e.currentStep=1,e.layouts=["rows","grid"],e.layout=0,e.theme=IBEConfig.theme||"c",e.themes=[{element:$("#Header"),themes:{a:"a",b:"b",c:"a",d:"a",e:"a",f:"a"}},{element:$("#ReservationContainer #Step1"),themes:{a:"a",b:"b",c:"c",d:"a",e:"a",f:"e"}},{element:$("#ReservationContainer #Step2"),themes:{a:"a",b:"b",c:"c",d:"a",e:"a",f:"d"}},{element:$("#ReservationContainer #Step3"),themes:{a:"a",b:"a",c:"a",d:"a",e:"a",f:"a"}},{element:$("#ReservationContainer #Step4"),themes:{a:"a",b:"a",c:"a",d:"a",e:"a",f:"a"}}],e.setTheme=function(){$("body").addClass("theme-"+e.theme),$.each(e.themes,(function(t,s){var a=s.themes[e.theme],o=s.element.data("template").replace("%theme%",a);s.element.attr("data-template",o).data("template",o)}))},e.onReadyEvents={step1:function(t){if(t){e.metaTitles=[IBE.Utils.translate("meta.title.1"),IBE.Utils.translate("meta.title.2"),IBE.Utils.translate("meta.title.3"),IBE.Utils.translate("meta.title.4"),IBE.Utils.translate("meta.title.contact"),IBE.Utils.translate("meta.title.myreservation")],""!==IBE.Utils.getReservationSetting(step1,"WelcomeMessage")&&IBE.Utils.bindTemplate("WelcomeMessage",step1),$(document).off("click",".bookwize-toggle"),$(document).on("click",".bookwize-toggle",e.toggleActive),$(".editable").focus((function(){$("label[for='"+this.id+"']").addClass("focused")})).blur((function(){$("label").removeClass("focused")})),$(document).mouseup((function(e){var t=$(".is-datepick"),s=$(".datepick-popup");s.is(e.target)||0!==s.has(e.target).length||t.is(e.target)||s.hide()})),$(document).mouseup((function(e){var t=$(".bookwize-guests-group");t.is(e.target)||0!==t.has(e.target).length||t.removeClass("active")}));var s=IBE.Utils.parseDeepLinking(window.location.search,step1);!1===s?("1"!==e.getParam(window.location.search,"page")&&History.pushState({page:"1"},e.metaTitles[0],"?page=1"),e.ready(t),$(".bookwize-steps").show(),e.scrollTo({offset:0,duration:0}),e.animate.stepContent(),$(document).on("click",".request-mealplan",(function(){})),$(".step1-offers .slide").length<=1&&$(".step1-offers .slide-prev, .step1-offers .slide-next").hide()):submitStep1(s),$(document).mouseup((function(e){var t=$(".active.bookwize-header-dropdown");t.is(e.target)||t.removeClass("active")}))}},step2:function(t){$(document).on("click",".bookwize-book-button",(function(){$(".bookwize-readmore-container").readmore({speed:75,moreLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("readMore")+"</div>",lessLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("close")+"</div>"}),setTimeout((function(){$(".bookwize-readmore-container").readmore({speed:75,moreLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("readMore")+"</div>",lessLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("close")+"</div>"})}),150)})),$(document).on("click",".bookwize-tab-name",e.animateTab),$(document).on("click",".bookwize-tab-name-activate",(function(){var e=$($(this).data("value")),t=$($(this).data("target"));e.siblings().removeClass("active"),e.addClass("active"),t.siblings().removeClass("active"),t.addClass("active")})),e.layout=IBE.Utils.getReservationSetting(step2,"IbeRoomsViewMode"),t&&(""!==step2.bookingProcess().couponCode()&&0===step2.offers().length&&(step2.message().severity("warning"),step2.message().text(IBE.Utils.translate("couponNotValidForPreferences")),step2.hasMessage(!0)),IBE.Utils.destroyView("Step1"),$.when(IBE.Utils.bindTemplate("Step2",step2)).then((function(){$.wait(500).then(function(){(guestPreferences=new IBE.ViewModels.Step1ViewModel).couponCode=step1.couponCode,guestPreferences.couponValid=step1.couponValid,guestPreferences.boardTypes=step1.boardTypes,guestPreferences.boardType=step1.boardType,guestPreferences.hasMessage=step1.hasMessage,guestPreferences.message=step1.message,guestPreferences.bookingProcess=step2.bookingProcess,guestPreferences.lang=step1.lang,guestPreferences.validate=function(t,s){e.updateCustomerPreferences(!0),step1.couponCode(t.couponCode()),step1.checkIn(guestPreferences.checkIn()),step1.checkOut(guestPreferences.checkOut()),step1.requestedRooms(guestPreferences.requestedRooms()),step1.validate()},guestPreferences.cancelDateChange=function(e,t){guestPreferences.checkIn(step1.checkIn()),guestPreferences.checkOut(step1.checkOut())},guestPreferences.cancelRoomChange=function(e,t){guestPreferences.requestedRooms.removeAll(),ko.utils.arrayForEach(step1.requestedRooms(),(function(e){guestPreferences.requestedRooms.push(e)}))},guestPreferences.events.subscribe((function(e){e&&(guestPreferences.checkIn(step1.checkIn()),guestPreferences.checkOut(step1.checkOut()),guestPreferences.couponCode(step1.couponCode()),guestPreferences.requestedRooms.removeAll(),guestPreferences.boardType(step2.request().preferredBoard()),ko.utils.arrayForEach(step1.requestedRooms(),(function(e){guestPreferences.requestedRooms.push(e)})))}),this,"ready"),guestPreferences.events.subscribe((function(e){e.success&&submitStep1(e.success),e.failure&&guestPreferences.message(e.failure)}),this,"submit"),guestPreferences.init(),$.when(IBE.Utils.bindTemplate("GuestPreferences",guestPreferences)).then((function(){$(document).on("click",".booking-process .well .navbar-collapse, .booking-process .well .navbar-collapse *",(function(e){e.stopImmediatePropagation(),$("#GuestPreferences-Step1").is(":hidden")?($("#GuestPreferences-Step1").stop().slideDown(),$("#GuestPreferences-Step1").addClass("open")):($("#GuestPreferences-Step1").stop().slideUp(),$("#GuestPreferences-Step1").removeClass("open"))}))})),step1.dispose(),step2.temporaryStep1=guestPreferences,step2.temporaryStep1.checkIn.subscribe((function(e){0!==moment(e).diff(step1.checkIn(),"days")?step2.preferencesChanged(!0):step2.preferencesChanged(!1)})),step2.temporaryStep1.checkOut.subscribe((function(e){0!==moment(e).diff(step1.checkOut(),"days")?step2.preferencesChanged(!0):step2.preferencesChanged(!1)})),step2.tempCouponCode=step1.couponCode(),step2.temporaryStep1.couponCode.subscribe((function(e){e!==step2.tempCouponCode?step2.preferencesChanged(!0):step2.preferencesChanged(!1)})),step2.tempRequestRooms=JSON.parse(ko.toJSON(ko.toJS(step1.requestedRooms()))),step2.temporaryStep1.requestedRooms.subscribe((function(e){var t=!1;e.forEach((function(e){e.value.guests.forEach((function(s){s.pax.subscribe((function(a){if(step2)var o=ko.utils.arrayFirst(step2.tempRequestRooms,(function(t){return t.roomIndex===e.value.roomIndex()}));if(null!=o){var i=ko.utils.arrayFirst(o.guests,(function(e){return e.ageCategory===s.ageCategory()&&e.label===s.label()}));null!=i&&(i.pax!==a?(step2.preferencesChanged(!0),t=!0):step2.preferencesChanged(!1))}}))}))})),t||(step2.temporaryStep1.requestedRooms().length!==step1.requestedRooms().length?step2.preferencesChanged(!0):step2.preferencesChanged(!1))}),null,"arrayChange")}()),History.pushState({page:"2"},e.metaTitles[1],"?page=2"),e.ready(t),0===$(".bookwize-step-2 .bookwize-progress-bar-text").length&&($(".bookwize-step-2").append($(".bookwize-progress-bar-inner")),$(".bookwize-step-2 .bookwize-step__description").append($(".bookwize-progress-bar-text"))),$(".bookwize-steps").show(),e.scrollTo({offset:0,duration:0}),e.animate.bgImage(),$.wait(500).then(e.animate.stepContent(".step2-content")),$(window).on("resize",e.resize),e.roomRowStyles(),$(".room-row").on("click",".book-room-button",e.bookRoom),$(document).on("click",".modal-header .close",(function(){$("#RoomPopUp").removeClass("in"),$("#RoomPopUp").hide(),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()})),$(document).on("click","#GuestPreferences .dropdown-menu",(function(e){if($(e.target).hasClass("btn-cancel"))return $(".dropdown-toggle").dropdown("toggle"),!0;e.stopImmediatePropagation()})),$(document).on("click",".change-layout li",e.toggleLayout),$(".change-layout li[data-layout='"+e.layouts[e.layout]+"']").trigger("click"),$(".room-list").on("click",".row-left",(function(){if(e.layout==e.layouts[1])return e.openRoomOverlay($(this)),!1})),$(".room-list").on("click",".room-row",(function(){e.layout==e.layouts[1]&&e.closeRoomOverlay($(this))}))})))},step3:function(t){e.ready(t),step3.flightInformation(!1),t&&(IBE.Utils.destroyView("Step2"),step3.bookingProcess().advancePayment()>0&&step3.bookingProcess().isOnline()&&"1"===IBEConfig.jcc_enable&&(step3.externalPaymentGateway(new IBE.ViewModels.ExternalPaymentGateway(step3,"JccRedirect",step3.externalPaymentGatewayData())),step3.typePaymentGateway("JccRedirect"),step3.externalPaymentGatewayCapabilities(IBE.Config.paymentGatewayCapabilities.NoFuturePayments.toString())),$.when(e.loadPaymentGatewayExternalResources(step3),IBE.Utils.bindTemplate("Step3",step3)).then((function(t){setTimeout((function(){$(".bookwize-supplements-inner:first-child").addClass("active"),$(".bookwize-readmore-container").readmore({speed:75,moreLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("readMore")+"</div>",lessLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("close")+"</div>"})}),150),$(document).on("click",".bookwize-supplements-header-title",(function(){$(".bookwize-room-readmore").readmore({speed:75,moreLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("readMore")+"</div>",lessLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("close")+"</div>"})})),$(document).ready((function(){void 0!==step3.externalPaymentGateway()&&step3.externalPaymentGateway().init()})),step2.dispose(),History.pushState({page:"3"},e.metaTitles[2],"?page=3"),e.scrollTo({offset:0})})),$(".editable").focus((function(){$("label[for='"+this.id+"']").addClass("focused")})).blur((function(){$("label").removeClass("focused")})),$(document).mouseup((function(e){var t=$(".active.bookwize-header-dropdown");t.is(e.target)||t.removeClass("active")})))},step4:function(t){if(t){if(IBE.Utils.destroyView("Step3"),"1"===IBEConfig.jcc_enable&&"NewReservationPaymentPending"===step4.reservation().status()){var s=btoa(step4.reservation().customer.email());Cache.write("authenticationKey",s);var a=new FormData;a.append("orderID",step4.reservation().code),a.append("currency",step4.reservation().currencyCode),a.append("purchaseAmt",step4.bookingProcess().advancePayment().toFixed(2)),a.append("url",window.location.origin+window.location.pathname+"?page=response"),$(".loader").show(),$.ajax({url:IBEConfig.redirect_page,data:a,processData:!1,contentType:!1,type:"POST",dataType:"html",success:function(e){$(".loader").show(),$("body").append(e),$("#paymentForm").submit()},error:function(e){console.log(e)}})}else IBE.Utils.bindTemplate("Step4",step4);History.pushState({page:"4"},e.metaTitles[3],"?page=4"),e.scrollTo({offset:0}),$(".bookwize-steps").hide(),$(".supplement-tooltip").on("click",(function(){$(this).parents(".supplement").find(".supplement-description").stop().slideToggle()})),$(document).mouseup((function(e){var t=$(".active.bookwize-header-dropdown");t.is(e.target)||t.removeClass("active")}))}e.ready(t)},ratePlan:function(t){t&&(IBE.Utils.bindTemplate("Rateplan",ratePlan),$("#Step1, .bookwize-steps").css("display","none"),$(".rateplan-page button").on("click",(function(){IBE.Utils.destroyView("Rateplan"),$("#Step1, .bookwize-steps").css("display","block"),History.replaceState(null,"",""),e.setStep(1)}))),e.ready(t)},contact:function(t){e.scrollTo({offset:0,duration:0}),e.ready(t),$(".bookwize-steps").hide(),t&&($("#ReservationContainer").children().each((function(e,t){ko.contextFor(t)&&(ko.cleanNode(t),$(t).html(""))})),IBE.Utils.destroyView("MyReservation"),IBE.Utils.bindTemplate("Contact",contact),e.isPageStateActive()||History.pushState({page:"Contact"},e.metaTitles[4],"?page=Contact"),e.animate.stepContent(".contact-content"))},myReservation:function(t){$(".editable").focus((function(){$("label[for='"+this.id+"']").addClass("focused")})).blur((function(){$("label").removeClass("focused")})),$(document).mouseup((function(e){var t=$(".active.bookwize-header-dropdown");t.is(e.target)||t.removeClass("active")}));var s=window.location.search.replace("?","").split("&");if(s.length<1)return!1;ko.utils.arrayForEach(s,(function(e){var t=e.split("=");if("lang"===t[0]&&"lang"!=typeof t[1]&&""!==t[1]){var s=ko.utils.arrayFirst(myReservation.languages(),(function(e){return e.locale===t[1]}));null!=s&&myReservation.lang(s.culture)}})),$(".bookwize-steps").hide(),e.ready(t),t&&($("#ReservationContainer").children().each((function(e,t){ko.contextFor(t)&&(ko.cleanNode(t),$(t).html(""))})),IBE.Utils.destroyView("Contact"),e.animate.stepContent(".myreservation-content"))},membership:function(t){var s=window.location.search.replace("?","").split("&");if(s.length<1)return!1;ko.utils.arrayForEach(s,(function(e){var t=e.split("=");if("lang"===t[0]&&"lang"!=typeof t[1]&&""!==t[1]){var s=ko.utils.arrayFirst(membership.languages(),(function(e){return e.locale===t[1]}));null!=s&&membership.lang(s.culture)}})),$(".bookwize-steps").hide(),e.ready(t),t&&IBEStepsMain.setStep("benefits")}},e.initStep1=function(){e.currentStep=1,header.view("book"),void 0===step1&&((step1=new IBE.ViewModels.Step1ViewModel).events.subscribe((function(e){e.success&&submitStep1(e.success),e.failure&&(IBE.Utils.consoleLog("Failed to submit step 1"),$("#GuestPreferences .customer-request .promocode .dropdown-toggle").dropdown("toggle"),IBE.Utils.consoleLog(e.failure))}),this,"submit"),step1.events.subscribe((function(t){"Forbidden"==t.severity&&e.ready(!1),loader.title("Failed to initialize booking engine :("),loader.message(t),loader.visible(!0),IBE.Utils.logEvent(t)}),this,"error"),step1.events.subscribe((function(t){e.onReadyEvents.step1(t)}),this,"ready")),step1.lang=e.lang,step1.currency=e.currency,$.when(IBE.Utils.bindTemplate("Step1",step1)).then((function(e){step1.init()})),step1.clearMessage()},e.initStep2=function(t){if(e.currentStep=2,header.view("book"),void 0===step2&&((step2=new IBE.ViewModels.Step2ViewModel).events.subscribe((function(e){submitStep2(e)}),this,"call"),step2.events.subscribe((function(e){submitStep2(e)}),this,"submit"),step2.events.subscribe((function(t){e.onReadyEvents.step2(t)}),this,"ready"),step2.events.subscribe((function(t){"Forbidden"===t.severity&&e.ready(!1),loader.title("Failed to initialize booking engine :("),loader.message(t),loader.visible(!0),IBE.Utils.logEvent(t)}),this,"error")),step2.lang=e.lang,step2.currency=e.currency,void 0!==t)try{IBE.Utils.destroyView("Step2"),step2.init(t),"function"==typeof ga&&ga("send","event","step1","submit")}catch(t){return step1.message(t.message),IBE.Utils.logEvent(t),e.ready(!0),!1}else e.onReadyEvents.step2(!0);return!0},e.initStep3=function(t){return e.currentStep=3,header.view("book"),void 0===step3&&((step3=new IBE.ViewModels.Step3ViewModel).useJcc=ko.observable(!1),step3.events.subscribe((function(e){submitStep3(e)}),this,"call"),step3.events.subscribe((function(e){(""!==step3.customer().arrivalTime()||step3.flightInformation())&&(e.notes+="<ul>",""!==step3.customer().arrivalTime()&&(e.notes+="<li>Arrival Time: "+ko.unwrap(step3.customer().arrivalTime)+"</li>"),step3.flightInformation()&&(e.notes+="<li><b>Flight Information</b></li>",e.notes+="<li>Flight Number: "+ko.unwrap(step3.flightInformationDetails.flightNumber)+"</li>",e.notes+="<li>Airport of Arrival: "+ko.unwrap(step3.flightInformationDetails.airportOfArrival)+"</li>",e.notes+="<li>Estimated Arrival Time: "+ko.unwrap(step3.flightInformationDetails.estimatedTime)+"</li>"),e.notes+="</ul>"),submitStep3(e)}),this,"submit"),step3.events.subscribe((function(t){e.onReadyEvents.step3(t),step3.bookingProcess().isOnline()&&step3.bookingProcess().advancePayment()>0&&"JccRedirect"===step3.typePaymentGateway()&&(step3.externalPaymentGateway(new IBE.ViewModels.ExternalPaymentGateway(step3,"JccRedirect",step3.externalPaymentGatewayData())),step3.displayExternalPayment(!0))}),this,"ready"),step3.events.subscribe((function(e){loader.title("Failed to initialize booking engine :("),loader.message(e),loader.visible(!0),IBE.Utils.logEvent(e)}),this,"error")),step3.lang=e.lang,step3.init(t),"function"==typeof ga&&ga("send","event","step2","submit"),step3.currency=e.currency,!0},e.initStep4=function(t){e.currentStep=4,header.view("book"),void 0===step4&&((step4=new IBE.ViewModels.Step4ViewModel).events.subscribe((function(e){submitStep3(e)}),this,"call"),step4.events.subscribe((function(e){submitStep3(e)}),this,"submit"),step4.events.subscribe((function(t){e.onReadyEvents.step4(t)}),this,"ready"),step4.events.subscribe((function(t){e.ready(!0),step3.ready(!0),step3.clearMessage(),step3.message(t),"critical"==t.severity&&(loader.title("Failed to submit booking :("),loader.message(t),loader.visible(!0)),IBE.Utils.logEvent(t)}),this,"error")),step4.lang=e.lang,step4.currency=e.currency;try{step4.init(t),"function"==typeof ga&&ga("send","event","step3","submit")}catch(t){step3.clearMessage();var s={id:"4001",severity:t.severity,text:t.text||t.message};return step3.message(s),IBE.Utils.logEvent(s),e.ready(!0),!1}return!0},e.initResponse=function(){e.currentStep="-response",e.ready(!1),"undefined"==typeof response&&(response=new IBE.ViewModels.ResponseViewModel),e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),e.destroyStep("guestPreferences");var t=$("#Response")[0];ko.cleanNode(t);try{$.when(ko.applyBindings(response,document.getElementById("Response"))).then((function(e){})),e.ready(!0),$("#Header").hide()}catch(t){return e.ready(!0),!1}return!0},e.initRatePlan=function(){var t=e.getParam(window.location.search,"rp");""===t&&(History.replaceState(null,"",""),e.setStep(1)),void 0===ratePlan&&(ratePlan=new IBE.ViewModels.Step1ViewModel).events.subscribe((function(t){e.onReadyEvents.ratePlan(t)}),this,"ready");try{ratePlan.setRateplan(parseInt(t))}catch(t){return e.setStep(1),!1}return!0},e.initMyReservation=function(){e.currentStep="-myreservation",e.ready(!1),header.view("myreservation"),void 0===myReservation&&((myReservation=new IBE.ViewModels.MyReservation({email:IBE.Utils.getParam(window.location.search,"email"),code:IBE.Utils.getParam(window.location.search,"code")})).events.subscribe((function(t){e.onReadyEvents.myReservation(t)}),this,"ready"),myReservation.events.subscribe((function(){e.setStep(1)}),this,"logout"),myReservation.events.subscribe((function(e){}),this,"login"),myReservation.events.subscribe((function(t){e.ready(!0),myReservation.ready(!0),myReservation.clearMessage(),myReservation.message(t),"critical"==t.severity&&(loader.title("Failed to fetch booking :("),loader.message(t),loader.visible(!0)),IBE.Utils.logEvent(t)}),this,"error")),e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),e.destroyStep("guestPreferences"),myReservation.lang=e.lang,myReservation.currency=e.currency;try{$.when(IBE.Utils.bindTemplate("MyReservation",myReservation)).then((function(e){myReservation.init()}))}catch(t){return e.ready(!0),myReservation.message(t),!1}return!0},e.initMembership=function(){e.currentStep="-membership",e.ready(!1),header.view("membership"),"undefined"==typeof membership&&(membership=new IBE.ViewModels.Membership,membership.events.subscribe((function(t){e.onReadyEvents.membership(t)}),this,"ready"),$(".bookwize-nav").removeClass("active"),membership.events.subscribe((function(){e.setStep(1)}),this,"logout"),membership.events.subscribe((function(e){}),this,"login"),membership.events.subscribe((function(e){e&&(IBEStepsMain.setStep("claimMembership"),membership.claimMembership.email(membership.username()))}),this,"memberNotExist"),membership.events.subscribe((function(t){e.ready(!0),membership.ready(!0),membership.clearMessage(),membership.message(t),"critical"==t.severity&&(loader.title("Failed to fetch booking :("),loader.message(t),loader.visible(!0)),IBE.Utils.logEvent(t)}),this,"error"),membership.events.subscribe((function(e){e&&IBEStepsMain.setStep("reservation")}),this,"showReservation"),membership.events.subscribe((function(e){e&&IBEStepsMain.setStep("webCheckin")}),this,"showCheckin"),membership.events.subscribe((function(e){e&&(window.location.href=window.location.href.split("&hash")[0],IBEStepsMain.setStep("login"))}),this,"password-changed")),e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),e.destroyStep("guestPreferences"),membership.lang=e.lang,membership.currency=e.currency;try{$.when(IBE.Utils.bindTemplate("Membership",membership)).then((function(e){membership.init()}))}catch(t){return e.ready(!0),membership.message(t),!1}return!0},e.initContact=function(){e.currentStep="-contact",e.ready(!1),header.view("contact"),void 0===contact&&((contact=new IBE.ViewModels.Contact).events.subscribe((function(t){e.onReadyEvents.contact(t)}),this,"ready"),contact.events.subscribe((function(e){e.success,e.failure&&IBE.Utils.consoleLog(e.failure)}),this,"submit")),contact.lang=e.lang,contact.currency=e.currency;try{contact.init()}catch(t){return e.ready(!0),contact.message(t),!1}return!0},e.setStep=function(t,s){e.currentStep=t,e.ready(!1),loader.visible(!0);switch(t){case 1:e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),e.initStep1();break;case 2:e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),e.initStep2(s),step2.selectedRooms().length>0&&(step2.selectedRooms().splice(step2.tabsCount-1,step2.tabsCount),$(".ui-tabs li:last-child").trigger("click"));break;case 3:if(e.destroyStep(4),$("#personalInvoice").click(),void 0===s){e.ready(!0);break}e.initStep3(s);break;case 4:if(void 0===s){e.ready(!0);break}e.initStep4(s);break;case"account":e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-Account",e),$(".bookwize-nav").removeClass("active"),$(".nav-"+t).addClass("active");break;case"benefits":membership.isAuthenticated()?(e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-Benefits",e),$(".bookwize-nav").removeClass("active"),$(".nav-"+t).addClass("active")):window.location.href.indexOf("hash")>-1?(e.destroyStep(1),e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-Reset",e),$(".bookwize-nav").removeClass("active"),$(".nav-"+t).addClass("active")):IBEStepsMain.setStep("login");break;case"reservation":e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-ViewReservation",e),$(".bookwize-nav").removeClass("active");break;case"reservations":e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-Reservations",e),$(".bookwize-nav").removeClass("active"),$(".nav-"+t).addClass("active");break;case"webCheckin":e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-Login"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-WebCheckin",e);break;case"login":e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-ClaimMembership"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-Login",e),$(".bookwize-nav").removeClass("active");break;case"claimMembership":e.destroyStep(2),e.destroyStep(3),e.destroyStep(4),IBE.Utils.destroyView("IBE-Member-Benefits"),IBE.Utils.destroyView("IBE-Member-ViewReservation"),IBE.Utils.destroyView("IBE-Member-Account"),IBE.Utils.destroyView("IBE-Member-Reservations"),IBE.Utils.destroyView("IBE-Member-WebCheckin"),IBE.Utils.destroyView("IBE-Member-Login"),membership.clearMessage(),e.ready(!0),IBE.Utils.bindTemplate("IBE-Member-ClaimMembership",e),$(".bookwize-nav").removeClass("active");break;default:e.ready(!0)}$(document).on("click",".culture .view-all-currencies",(function(e){e.stopPropagation()})),$(document).on("focus",".editable",(function(e){$("label[for='"+this.id+"']").addClass("focused")})),$(document).on("blur",".editable",(function(e){$("label").removeClass("focused")})),$(document).on("click",".bookwize-step",(function(t){if($(this).hasClass("inactive")||$(this).hasClass("active"))return t.preventDefault(),!1;var s=$(this).index(".bookwize-step")+1;e.currentStep!=s&&e.setStep($(this).index(".bookwize-step")+1)}))},e.destroyStep=function(e){switch(e){case 1:IBE.Utils.destroyView("Step1"),step1&&(step1.dispose(),step1=void 0);break;case 2:IBE.Utils.destroyView("Step2"),step2&&(step2.dispose(),step2=void 0);break;case 3:IBE.Utils.destroyView("Step3"),step3&&(step3.dispose(),step3=void 0);break;case 4:IBE.Utils.destroyView("Step4"),step4&&(step4.dispose(),step4=void 0);break;case"guestPreferences":IBE.Utils.destroyView("GuestPreferences"),guestPreferences&&(guestPreferences.dispose(),guestPreferences=void 0)}},e.navigationSteps=function(t){$(".bookwize-step").removeClass("active").removeClass("inactive").removeClass("modify"),$(".bookwize-step").each((function(s,a){(s>t||4==e.currentStep)&&$(this).addClass("inactive"),s==t&&$(this).addClass("active"),s<t&&$(this).addClass("modify"),0==t&&($(".bookwize-step").removeClass("modify"),$(".bookwize-progress-bar-text").remove(),$(".bookwize-progress-bar-inner").remove())}))},e.bookRoom=function(t){e.scrollTo({offset:0})},e.animateLabel=function(){""!==$(this).val()?$(this).parent().addClass("up"):$(this).parent().removeClass("up")},e.animateTab=function(){var e=$(this),t=$(e.data("target"));e.siblings().removeClass("active"),e.addClass("active"),t.siblings().removeClass("active"),t.addClass("active")},e.toggleActive=function(){var e=$(this),t=e.parent(),s=$(e.data("target"));t.hasClass("active")?(t.removeClass("active"),s.hide()):(t.addClass("active"),s.show(),e.hasClass("bookwize-supplements-header")&&$(".bookwize-readmore-container").readmore({speed:75,moreLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("readMore")+"</div>",lessLink:'<div class="readmore-js-toggle">'+IBE.Utils.translate("close")+"</div>"}))},e.applyBodyClass=function(){for(var t=$("body").attr("class").split(" "),s=0;s<t.length;s++)"step"===t[s].slice(0,4)&&$("body").removeClass(t[s]);$("body").addClass("step"+e.currentStep)},e.resize=function(){try{e.resizeRoomImages()}catch(e){}},e.resizeRoomImages=function(){var t=$(window).width();t<=990&&(step2.roomImageWidth(964),step2.roomImageHeight(250)),t>990&&t<=1200&&("grid"==e.layout?(step2.roomImageWidth(964),step2.roomImageHeight(250)):(step2.roomImageWidth(291),step2.roomImageHeight(210)))},e.toggleLayout=function(t){t.stopPropagation();var s=$(".change-layout li.active").data("layout"),a=$(this).data("layout");e.layout=a,$(".change-layout li").removeClass("active"),$(this).addClass("active");var o=$(".room-list");o.removeClass("layout-"+s),o.addClass("layout-"+a),o.addClass("anim"),"grid"==a?(o.find(".room-row").addClass("col-lg-4"),o.find(".room-row .row-right .room-action").addClass("clearfix"),o.find(".room-row .row-right .room-prices").addClass("col-lg-6"),o.find(".room-row .row-right .booking-action").addClass("col-lg-6 no-padding")):(o.find(".room-row").removeClass("col-lg-4"),o.find(".room-row .row-right .room-action").removeClass("clearfix"),o.find(".room-row .row-right .room-prices").removeClass("col-lg-6"),o.find(".room-row .row-right .booking-action").removeClass("col-lg-6"),o.find(".room-row .row-right .booking-action").removeClass("no-padding"),o.find(".table-list").slideDown(300)),e.resizeRoomImages(),e.roomRowStyles()},e.popup={$el:null,events:function(t,s){e.popup.$el.off("shown.bs.modal"),e.popup.$el.off("hidden.bs.modal"),e.popup.$el.on("shown.bs.modal",(function(a){$("html").addClass("modal-open"),$(".modal-backdrop").height($(document).height()),e.popup.accordion(),e.popup.selectMenu(s),t.find(".popup-rateplan .book-room-button button").on("click",(function(){e.popup.close(),e.bookRoom()}))})),e.popup.$el.on("hidden.bs.modal",(function(e){$("html").removeClass("modal-open")}))},open:function(t){var s=!0;e.layout==e.layouts[1]&&($(this).hasClass("row-left")||$(this).hasClass("room-header"))&&(e.openRoomOverlay($(this)),s=!1),s&&(e.popup.$el=$(document).find("#RoomPopUp"),e.popup.events(e.popup.$el,$(this)),e.popup.$el.modal("show"))},close:function(e){$("#RoomPopUp").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()},accordion:function(){$("#ReservationContainer").on("shown.bs.collapse",".panel-collapse",(function(){var e=$(this).parents(".panel");e.find("a .fa-caret-down").hide(),e.find("a .fa-caret-up").show()})),$("#ReservationContainer").on("hidden.bs.collapse",".panel-collapse",(function(){var e=$(this).parents(".panel");e.find("a .fa-caret-down").show(),e.find("a .fa-caret-up").hide()}))},selectMenu:function(t){var s=t.data("target");void 0===s&&(s="room-info"),e.popup.$el.find(".sidebar .list-group .list-group-item[data-target='"+s+"']").trigger("click");var a=t.data("rateplanId"),o=t.parents(".room-row").data("room-id");void 0!==a&&e.popup.$el.find(".nav-pills li a[data-rateplan-id='"+a+"']").trigger("click"),IBE.Utils.gaTrack({action:"send",command:"event",data:"/step2/popup/room-"+o})}},e.closeRoomOverlay=function(t){$(".room-list").removeClass("anim"),t.find(".row-left").slideDown(300,(function(){t.find(".row-left").removeAttr("style")})),t.find(".table-list").slideUp(300,(function(){t.find(".table-list").removeAttr("style")})),e.roomRowStyles(t)},e.roomRowStyles=function(e){var t=function(e){var t=e.length;t>=3&&e.eq(t-1).css({borderBottom:"none"}),t>3&&$(this).find(".row-center").css({"-webkit-border-radius":"0px 0px 2px 2px","border-radius":"0px 0px 2px 2px"})};if(void 0===e)$(".room-list .room-row").each((function(e,s){var a=$(this).find(".table-list .list-row");t(a)}));else{var s=e.find(".table-list .list-row");t(s)}},e.scrollTo=function(e){e=$.extend({offset:0,duration:177,callback:function(){}},e),$("html:not(:animated), body:not(:animated)").animate({scrollTop:e.offset},{duration:e.duration,complete:function(){e.callback()}})},e.animate={bgImage:function(e){e=e||".background-image",$(e).addClass("animating")},stepContent:function(e,t){e=e||".step1-content",$(e).addClass("animating")},steps:function(e,t){e=e||".steps",$(e).addClass("animating")},roomRow:function(e,t){e=e||".room-row",$(e).addClass("animating")}},e.pushStates=function(){History.options.hashChangeInterval=500,$(document).on("click","a",(function(t){var s=$(this).parent(),a=$(this).attr("href"),o=$(this).attr("title"),i=e.getParam(a,"page");return!s.is(".bookwize-step.inactive")&&(e.currentStep!=e.getParam(a,"page")&&(""!=i&&-1!=window.location.href.indexOf(IBEConfig.integrated_page)&&(t.preventDefault(),routes.hasOwnProperty(i)?History.pushState({page:e.getParam(a,"page")},o,a):History.pushState({page:"1"},e.metaTitles[0],"?page=1"),e.closeAnimatedElements()),!0))}))},e.getParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null==s?"":decodeURIComponent(s[1].replace(/\+/g," "))},e.isPageStateActive=function(){return e.getParam(window.location.search,"page")==History.getState().data.page},e.closeAnimatedElements=function(){$.each([".header-sidebar",".reservation-container"],(function(e,t){$.each($(t),(function(e,t){var s=$(t).attr("class").split(" ");$(s).each((function(e,t){s[e]=-1===t.indexOf("animate-")?t:""})),$(t).attr("class",s.join(" "))}))}))},e.loadPaymentGatewayExternalResources=function(e){if(void 0!==e.externalPaymentGateway()){urls=[],"Stripe"===e.typePaymentGateway()&&urls.push("https://js.stripe.com/v3/");var t=urls.map((function(e){return function(e,t){return new Promise((function(t,s){var a;(a=document.createElement("script")).type="text/javascript",a.src=e,a.onload=function(){t(e)},a.onerror=function(){s(e)},document.getElementsByTagName("head")[0].appendChild(a)}))}(e)}));return Promise.all(t)}}}function Loader(){var e=this,t=ko.observable(!1);e.$loader=$(".loader"),e.title=ko.observable("Please wait ..."),e.message=ko.observable(new IBE.Models.Message),e.showError=ko.computed((function(){return"critical"==e.message().severity})),e.clear=function(){e.message(new IBE.Models.Message),e.title("")},e.reload=function(){e.clear(),window.location.reload()},e.visible=ko.computed({read:function(){return t()},write:function(s){e.message().id>0?t(!0):t(s),t()?e.$loader.show():e.$loader.hide()}}).extend({notify:"always"})}$.wait=function(e){var t=$.Deferred();return setTimeout((function(){t.resolve()}),e),t};var allowForward=!1;function submitStep1(e){step2&&!step2.preferencesChanged()||e&&(allowForward=!0,IBEStepsMain.ready(!1),IBEStepsMain.setStep(2,e))}function submitStep2(e){e&&(allowForward=!0,IBEStepsMain.ready(!1),IBEStepsMain.setStep(3,e))}function submitStep3(e){e&&(allowForward=!0,IBEStepsMain.ready(!1),IBEStepsMain.setStep(4,e))}IBEStepsMain=new MainView,$((function(){if((loader=new Loader).visible(!0),IBEStepsMain.formModel=ko.observable(!1),$(".bookwize-integrated-form").length){(step1=new IBE.ViewModels.Step1ViewModel).init();var e=0;step1.submit=function(t){if(t){var s=step1.checkIn().format("YYYY-MM-DD"),a=step1.checkOut().format("YYYY-MM-DD");ko.utils.arrayForEach(step1.requestedRooms()[0].guests,(function(t){"Adult"===t.ageCategory()?e+=t.pax():e+=("/"+t.fromAge()).repeat(t.pax())}));var o="";"f"!==IBEConfig.theme&&(o=step1.boardType());window.location.href=IBE.Config.integrated_page+"?page=2&ci="+s+"&co="+a+"&r="+e+"&board="+o}t.failure&&IBE.Utils.consoleLog("Failed to submit step 1")},$(".bookwize-integrated-form .btn-primary").css("background",IBE.Config.bwButtonColor),$(".bookwize-integrated-form").show()}ko.applyBindings(loader,document.getElementById("Loader")),(header=new IBE.ViewModels.HeaderViewModel).view.subscribe((function(e){switch(e){case"book":$(".steps").show();break;default:$(".steps").hide()}})),IBEStepsMain.isIntegratedPage()&&IBE.Utils.bindTemplate("Header",header,void 0,{afterRender:function(){header.init()}}),lang&&header.lang(lang),IBEStepsMain.lang=header.lang,IBEStepsMain.currency=header.currency,IBEStepsMain.pushStates(),$("#Currency").length&&$.when(IBE.Utils.bindTemplate("Currency",header)).then((function(){header.init()}))})),IBEStepsMain.isIntegratedPage()&&function(e,t){var s=IBEStepsMain.getParam(e.location.search,"theme");""!==s&&(IBEStepsMain.theme=s),IBEStepsMain.setTheme();var a=$("html").attr("lang");a&&a[3]&&-1!=IBE.Config.languages.indexOf(a[3])&&(lang=a[3]),IBEStepsMain.lang(lang),History.Adapter.onDomLoad((function(t){var s=History.getState();if(void 0===s.data.page){var a=IBEStepsMain.getParam(e.location.search,"page");if(""==a)""!=IBEStepsMain.getParam(e.location.search,"rp")&&(a="rp");s.data.page=""==a?"1":a}switch(s.data.page=""+s.data.page,s.data.page.toLocaleLowerCase()){case"myreservation":IBEStepsMain.initMyReservation();break;case"membership":IBEStepsMain.initMembership();break;case"response":IBEStepsMain.initResponse();break;case"contact":IBEStepsMain.initContact();break;case"rp":IBEStepsMain.initRatePlan();break;default:var o=Cache.read("ReservationUser");if(!1!==o){IBEStepsMain.setStep(4,o);break}IBEStepsMain.setStep(1),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/step1"})}})),History.Adapter.bind(e,"statechange",(function(t){var s=History.getState(),a=History.savedStates,o=a[a.length-2];if("MyReservation"==o.data.page&&"2"==s.data.page&&(s.data.page="1"),"MyReservation"==o.data.page&&"3"==s.data.page&&(s.data.page="1"),"MyReservation"==o.data.page&&"4"==s.data.page&&(s.data.page="1"),"Membership"==o.data.page&&"2"==s.data.page&&(s.data.page="1"),"Membership"==o.data.page&&"3"==s.data.page&&(s.data.page="1"),"Membership"==o.data.page&&"4"==s.data.page&&(s.data.page="1"),void 0!==s.data.page){if(1==s.data.page.length&&o.data.page<s.data.page&&0==allowForward&&History.pushState({page:o.data.page+""},IBEStepsMain.metaTitles[o.data.page-1],"?page="+o.data.page),"4"==o.data.page&&s.data.page<o.data.page&&(s.data.page="1"),"4"==s.data.page&&"3"!=o.data.page){if(!1!==Cache.read("ReservationUser"))return!0;s.data.page="1"}if("3"==s.data.page&&"2"!=o.data.page&&(s.data.page="1"),IBEStepsMain.getParam(e.location.search,"page")==o.data.page||s.data.page==o.data.page)return!1;IBEStepsMain.popup.close();var i,r=IBE.Utils.parseDeepLinking(e.location.search,step1);if(!1!==r)return submitStep1(r),!0;switch(routes.hasOwnProperty(s.data.page)||History.pushState({page:"1"},IBEStepsMain.metaTitles[0],"?page=1"),1==s.data.page.length&&o.data.page>s.data.page&&1==allowForward&&(allowForward=!1),s.data.page=""+s.data.page,s.data.page.toLocaleLowerCase()){case"myreservation":IBE.Utils.prepareView("myreservation"),IBEStepsMain.initMyReservation(),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/myreservation"});break;case"membership":IBE.Utils.prepareView("membership"),IBEStepsMain.initMembership(),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/membership"});break;case"contact":IBE.Utils.prepareView("contact"),IBEStepsMain.initContact(),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/contact"});break;case"rp":IBE.Utils.prepareView("rateplan"),IBEStepsMain.initRatePlan(),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/rateplan"});break;case"1":i=s.data.page,IBE.Utils.prepareView(i),IBEStepsMain.setStep(parseInt(i)),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/step1"}),IBE.Utils.gaRemarketingTrack(IBE.Utils.getReservationSetting(step1,"adwordsConversionId"));break;case"2":if(2===IBEStepsMain.currentStep)return;i=s.data.page,IBE.Utils.prepareView(i),IBEStepsMain.setStep(parseInt(i)),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/step2"}),IBE.Utils.gaRemarketingTrack(IBE.Utils.getReservationSetting(step2,"adwordsConversionId"));break;case"3":i=s.data.page,IBE.Utils.prepareView(i),IBEStepsMain.setStep(parseInt(i)),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/step3"});break;case"4":i=s.data.page,IBE.Utils.prepareView(i),IBEStepsMain.setStep(parseInt(i)),IBE.Utils.gaTrack({action:"send",command:"pageview",data:"/step4"});break;default:IBE.Utils.consoleLog("invalid url:"+s.data.step)}}else History.pushState({page:"1"},IBEStepsMain.metaTitles[0],"?page=1")}))}(window);